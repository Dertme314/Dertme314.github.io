// This is a Vercel Serverless Function
// It will act as our proxy.

export default async function handler(req, res) {
    // The target WEAO API URL
    const apiUrl = 'https://weao.xyz/api/status/exploits';
    
    // The required headers
    const headers = {
        'User-Agent': 'WEAO-3PService',
        'Accept': 'application/json'
    };

    try {
        // 1. Make the request to the WEAO API
        const response = await fetch(apiUrl, { headers });

        if (!response.ok) {
            // If the WEAO API fails, send its error back
            throw new Error(`WEAO API responded with status: ${response.status}`);
        }

        const data = await response.json();

        // 2. Set headers to allow your website to use this API
        // This * is for development, you can lock this to your
        // .vercel.app URL later for more security
        res.setHeader('Access-Control-Allow-Origin', '*');
        
        // 3. Set caching: Vercel will cache this response for 60 seconds
        res.setHeader('Cache-Control', 's-maxage=60, stale-while-revalidate');

        // 4. Send the data from WEAO back to your front-end
        res.status(200).json(data);

    } catch (error) {
        console.error('Proxy Error:', error.message);
        // Send an error back to your front-end
        res.status(500).json({ error: 'Failed to fetch data from WEAO API' });
    }
}
